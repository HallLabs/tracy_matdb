 
Database Types
==============

Depending on the needs of the potential, different configuration types
need to be generated for training. Each configuration type is referred
to loosely as a "Group" and `matdb` supports multiple group types:

1. Enumerated structures selected from an enumerated list of
   symmetrically distinct configurations.
2. AFLOW which allows the querying of the `aflowlib.org` database.
3. Active which contains structures being used for `mtp` active learning.
4. Distortion which distorts the atoms within the seed configurations.
5. Substitution which changes the stoichiometry of the seed
   configuration.
6. Vacancy which introduces vacancies into the atomic basis of the
   seed configuration.
7. Manual which allows for a database to be constructed from user
   supplied seed configurations.

Seed Configurations
*******************

Many of the database groups need seed configurations to run. Since
`matdb` interfaces with multiple calculators and file formats. As such
it is neccessary that the file format of each config file to be used
by a group be set by the user using the `seeds` keyword:

.. code-block:: yaml

   steps:
     - type: 'simple.Manual'
       seeds: ["POSCAR:PdAg25","POSCAR:PdAgp0","POSCAR:PdAg75"]

`seeds` take a list of configuration files as "file format : file
name". The file format can be any that are recognized by the
`ase.io.read`_. The files can have any name desired by the
user but they must be stored in a folder called *SEED* located in the
root directory for the database. 

.. _ase.io.read: https://wiki.fysik.dtu.dk/ase/ase/io/io.html

Databases that use seed configurations are: `vacancy`, `distortion`,
`substitution`, and `manual`. The other databases generate their own
configurations or have the configurations generated by other
processes, like the `active` database whose configurations are
generated during the `active` learning phase of an `mtp` potential
fit.

YML File Specifications
***********************

The `databases` section of the yml file details the databases to be
constructed for later use. Databases can be broken down into groups
which inherit configurations from each other or they can be built from
a single database group. Each `database` section must have a `name`
and contain the `steps` field which details which groups to construct
and in which order for that database.

For example:

.. code-block:: yaml

   databases:
     #The PhononBase class generates the dynamical matrix that is needed
     #by PhononDatabase.
     - name: 'enumerated'
       steps:
         - type: "enumerated.Enumerated"
           lattice*:
             - "bcc"
             - "fcc"
           nconfigs: 10
           sizes: [1,10]
           ran_seed: 10
         - type: "vacancy.Vacancy
           vac_per_atm: 0.2
     - name: "Aflow"
       steps:
         - type: "aflow.Aflow"
    	   catalog: 'icsd'
	   batch_size: 100
	   filters:
  	     - - - ["Egap", ">", 0]
	         - "&"
	         - ["Egap", "<", 2]
  	       - "|"
	       - - ["Egap", ">", 5]
	         - "&"
	         - ["Egap", "<", 7]
	     - - - ["species", "==" ,"Ag"]
	         - "&"
	         - ["species", "==", "Pd"]
	   select:
	     - "agl_thermal_conductivity_300K"
	   orderby:
  	     keyword: "agl_thermal_conductivity_300K"
	     desc: True
     - name: "Manual"
       steps:
         - type: "simple.Manual"
	   seeds: ["POSCAR:PdAg25","POSCAR:PdAgp0","POSCAR:PdAg75"]

   
In the above example three different databases are created. For the
first an initial set of 20, 10 fcc and 10 bcc, structures are created
using the `enumerated` database group. Once the calculations for that
database have been completed then the `vacancy` database group
inherits the enumerated configurations as seed configurations that it
will then add vacancies to before it's own calculations will run. For
the second the `aflow` group is used to querry aflow for
configurations that have a specific set of parameters regarding the
band gap energy, once the configurations have been retreived from
`aflow` the computations for this group will start. The last is the
manual group which will take the three supplied configurations,
located in the `SEED` directory and perform calculations on them.

.. note:: For this setup computations from all 3 databases will start
          at once, only the `vacancy` group calculations will wait for
          the `enumeration` group to be finished before they start.
	     
.. toctree::
   :maxdepth: 1
   :caption: Databases:

   database/enumerated.rst
   database/aflow.rst
   database/active.rst
   database/distortion.rst
   database/substitution.rst
   database/vacancy.rst
   database/manual.rst
   database/hessian.rst
   database/legacy.rst
   database/liquid.rst
   database/md.rst
   database/prototype.rst


.. toctree::
   :maxdepth: 1
   :caption: Utility Modules:

   database/utility.rst