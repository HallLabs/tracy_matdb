
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Fitting for MTP Potentials &#8212; matdb 0.0.5 documentation</title>
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Basic Trainer Documentation" href="basic.html" />
    <link rel="prev" title="Potential Fitting API" href="../fitting.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="basic.html" title="Basic Trainer Documentation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../fitting.html" title="Potential Fitting API"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">matdb 0.0.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../fitting.html" accesskey="U">Potential Fitting API</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="fitting-for-mtp-potentials">
<h1>Fitting for MTP Potentials<a class="headerlink" href="#fitting-for-mtp-potentials" title="Permalink to this headline">¶</a></h1>
<p>MTP (Moment Tensor Potential) use a polynomial basis to expand the
interatomic potential and offer fast calculation times for relaxing
cells and calculating the energies and forces of an atomic
configuration. The pontentials are also adaptable in terms of
accuracy, in that they can be expanded to be more accurate but then
they take a little longer to run.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">MTP fits require unrelaxed calculations to be
effecetive. Please ensure the database you are using does
not contain relaxations.</p>
</div>
<div class="section" id="yml-file-specifications">
<h2>YML file specifications<a class="headerlink" href="#yml-file-specifications" title="Permalink to this headline">¶</a></h2>
<p>To fit an MTP potential the use <cite>mtp.MTP</cite> in the <cite>type</cite> field of the
fitting step. The MTP section of the yml file requires the <cite>species</cite>
section be provided and can take <cite>relax_ini</cite>, <cite>relax</cite>, <cite>ran_seed</cite>,
<cite>train</cite>, <cite>smallest_relax_cell</cite>, <cite>largest_relax_cell</cite>, <cite>calc_grade</cite>,
<cite>select</cite>, <cite>use_mpi</cite>, <cite>use_unrelaxed</cite>, and <cite>crystals_to_relax</cite>.</p>
<div class="section" id="relax-ini">
<h3>relax_ini<a class="headerlink" href="#relax-ini" title="Permalink to this headline">¶</a></h3>
<p>The <cite>relax_ini</cite> section can contain the following fields and values:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>calc-efs</strong>: (bool) If <cite>TRUE</cite> then <cite>mlp</cite> will calculate the energy,</dt>
<dd>force, and stress of the configuration of atoms. Input can be
either <cite>TRUE</cite> or <cite>FALSE</cite>, default value <cite>TRUE</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>efs-ignore</strong>: (bool) If <cite>TRUE</cite> then energy, force and stress</dt>
<dd>calculations will be ignored in fitting situations. Input can be
either <cite>TRUE</cite> or <cite>FALSE</cite>, default value <cite>FALSE</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>active-learn</strong>: (bool) Turns on/off the selection, i.e., active</dt>
<dd>learning engine. Default value <cite>TRUE</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>fit</strong>: (bool) Turns fitting on/off. Input can be either <cite>TRUE</cite> or</dt>
<dd><cite>FALSE</cite>, default value <cite>FALSE</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>site-weight</strong>: (float) Sets the weights for the site energy</dt>
<dd>calculation in the selection procedure. Default value 0.0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>energy-weight</strong>: (float) Sets the weights for the energy</dt>
<dd>calculation in the selection procedure. Default value 1.0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>force-weight</strong>: (float) Sets the weights for the force calculation</dt>
<dd>in the selection procedure. Default value 0.001.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>stress-weight</strong>: (float) Sets the weights for the force calculation</dt>
<dd>in the selection procedure. Default value 0.0001.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>threshold</strong>: (float) Sets the maximum allowed extrapolation level</dt>
<dd>for a configuration, i.e., anything larger than this will be
included in the list of structures for the active learning to
select from. Default of 2.0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>threshold-break</strong>: (float) Sets the breaking threshold for the</dt>
<dd>code. If a structure reaches this extrapolation grade then the
code will break and not try to relax it any further. Default of
10.0.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="crystals-to-relax">
<h3>crystals_to_relax<a class="headerlink" href="#crystals-to-relax" title="Permalink to this headline">¶</a></h3>
<p>The crystals to relax field takes a list of crystal structures to
include in the <cite>to_relax.cfg</cite> file. Valid options to include are <cite>sc</cite>,
<cite>bcc</cite>, <cite>fcc</cite>, <cite>hcp</cite>, and <cite>prototypes</cite> where <cite>sc</cite> stands for simple
cubic, <cite>bcc</cite> stands for body-centered cubic, <cite>fcc</cite> stands for
face-centered cubic, <cite>hcp</cite> stands for hexagonal close packed, and
<cite>prototypes</cite> is a list of structures that have been found to exist in
nature. The default behavior is to include all of these in the
<cite>to_relax.cfg</cite> file.</p>
</div>
<div class="section" id="train">
<h3>train<a class="headerlink" href="#train" title="Permalink to this headline">¶</a></h3>
<p>The <cite>train</cite> section of the yml file can defines the options and values
that will get passed to the <cite>mlp</cite> <cite>train</cite> command when training the
interatomic potential. Valid options are:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>energy-weight</strong>: (float) The weight of energies in the</dt>
<dd>fitting. Default is 1.0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>force-weight</strong>: (float) The weight of forces in the</dt>
<dd>fitting. Default is 0.01.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>stress-weight</strong>: (float) The weight of stresses in the</dt>
<dd>fitting. Default is 0.001.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>scale-by-force</strong>: (float) If given value is &gt;0 then configurations</dt>
<dd>near equilibrium (with roughly force &lt; the given value) get more
weight. Default is 0.0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>max-iter</strong>: (integer) The maximal number of BFGS</dt>
<dd>iterations. Default is 1000.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>trained-pot-name</strong>: (string) The filename for trained potential to</dt>
<dd>be saved to. Default is <cite>Trained.mtp_</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>bfgs-conv-tol</strong>: (float) The stopping criterion for optimization in</dt>
<dd>the BFGS algorithm. Default is 1e-8.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>weighting</strong>: (string) Determines how to weight configuration wtih</dt>
<dd>different sizes relative to each other. Options are <cite>molecules</cite>,
<cite>structures</cite>, or <cite>vibrations</cite>, default is <cite>vibrations</cite></dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>init-params</strong>: (string) Determins how to initialize parameters if a</dt>
<dd>potential was not pre-fitted. Default is random. Options include
<cite>random</cite> and <cite>same</cite> - this is when interaction of all species is
the same (more accurate fit, but longer optimization), default is
<cite>random</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>skip-preinit</strong>: If present then skip the 75 iterations done when</dt>
<dd>params are not given.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="calc-grade">
<h3>calc_grade<a class="headerlink" href="#calc-grade" title="Permalink to this headline">¶</a></h3>
<p>The <cite>calc_grade</cite> section of the yml file contains the options and
values that will get passed to the <cite>mlp</cite> <cite>calc-grade</cite> command for
calculating the grade of each configuration in the active set and
determining the best set of active configurations. Valid options are:</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>init-threshold</strong>: (float) Sets the initial threshold to</dt>
<dd>1+value. Default is 1e-5.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>select-threshold</strong>: (float) Sets the selection threshold to the value,</dt>
<dd>i.e., nothing will be selected unless it has at least this
extrapolation grade. Default is 1.1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>swap-threshold</strong>: (float) Sets the swap threshold to the</dt>
<dd>value. Default is 1.0000001.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>energy-weight</strong>: (float) Sets the weight for energy</dt>
<dd>equation. Default is 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>force-weight</strong>: (float) Sets the weight for force</dt>
<dd>equations. Default is 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>stress-weight</strong>: (float) Sets the weight for stress</dt>
<dd>equations. Default is 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>nbh-weight</strong>: (float) Sets the weight for site energy</dt>
<dd>equations. Default is 0.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="relax">
<h3>relax<a class="headerlink" href="#relax" title="Permalink to this headline">¶</a></h3>
<p>The <cite>relax</cite> section of the yml file contains the options for the
relaxation step in the fitting iteration. The inputs will be passed to
the <cite>mlp</cite> <cite>relax</cite> command. Valid options are:</p>
<ul class="simple">
<li><strong>pressure</strong>: (float) Sets an external pressure, in GPa. Default 0.</li>
<li><dl class="first docutils">
<dt><strong>iteration_limit</strong>: (integer) Sets the maximum number of BFGS</dt>
<dd>iterations to take.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>min_dist</strong>: (float) Sets the minimum allowed distance between</dt>
<dd>atoms. If atoms get any closer than this the relaxation will be
terminated. Expressed in Angstroms.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>force-tolerance</strong>: (float) Sets the force tolerance for relaxation</dt>
<dd>termination. If the forces on the atoms drop below this number then
the relaxation will end. Zero disables atomic
relaxations. Expressed in eV/Angstrom.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>stress-tolerance</strong>: (float) Sets the stress tolerance for</dt>
<dd>relaxation tcermination. If the stress on the system drops below
this number then relaxation will stop. Zero disables atomic
relaxations. Expressed in GPa.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>max-step</strong>: (float) Sets the maximum allowed displacement of atoms</dt>
<dd>and lattice vectors. Expressed in Angrstroms.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>min-step</strong>: (float) Sets the minimum atomic and cell vector</dt>
<dd>displacement for relaxation. If the displacementens are smaller
than this the relaxation stops, i.e., the cell is already
relaxed. Expressed in Angrstroms.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>bfgs-wolfe_c1</strong>: If specified the bfgs wolfe code 1 will be used</dt>
<dd>for relaxation.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>bfgs-wolfe_c2</strong>: If specified the bfgs wolfe code 2 will be used</dt>
<dd>for relaxations.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="select">
<h3>select<a class="headerlink" href="#select" title="Permalink to this headline">¶</a></h3>
<p>The <cite>select</cite> section of the yml file contains options that will be
passed to the <cite>mlp</cite> <cite>select</cite> command. This command is used for the
active learning step and will decide which new structures from those
which failed to relax will be should be included in the next training
iteration. Valid options are:</p>
<ul class="simple">
<li><strong>init-threshold</strong>: (float) Sets the initial threshold. Default 1E-5.</li>
<li><strong>select-threshold</strong>: (float) Sets the selection threshold. Default 1.1.</li>
<li><dl class="first docutils">
<dt><strong>swap-threshold</strong>: (float) Sets the threshold for configuration</dt>
<dd>swapping. Default 1.0000001.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>energy-weight</strong>: (float) Sets the weight for the energy</dt>
<dd>equation. Default 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>force-weight</strong>: (float) Sets the weight for the force</dt>
<dd>equations. Default 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>stress-weight</strong>: (float) Sets the weight for the stress</dt>
<dd>equations. Default 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>nbh-weight</strong>: (float) Sets the weight for the site energy</dt>
<dd>equation. Default 0.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>selection-limit</strong>: (integer) Sets the largest number of structures</dt>
<dd>that can be added to the training set in this iteration. Default 0
(disables this function).</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>weighting</strong>: (string) Sets the way of weighting the functional for</dt>
<dd>better fitting. Options are <cite>vibrations</cite>, <cite>molecules</cite>,
<cite>structures</cite>. Default is <cite>vibrations</cite>.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="other">
<h3>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><dl class="first docutils">
<dt><strong>smallest_relax_cell</strong>: (integer) The smallest cell size to include in the</dt>
<dd><cite>to_relax.cfg</cite> file. Values must be positive integers smaller than
<cite>largest_relax_cell</cite>, default value 1.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>largest_relax_cell</strong>: (integer) The largest cell size to include in the</dt>
<dd><cite>to_relax.cfg</cite> file. Values must be positive integers larger that
<cite>smallest_relax_cell</cite>, default value depends on the number of
species in the system.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>ran_seed</strong>: (float) random seed to be used for MTP related calculations</dt>
<dd>when a random seed is needed.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>species</strong>: (list of strings) This field takes a list of the atomic species in the</dt>
<dd>system.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>use_unrelaxed</strong>: (bool) If true then if the <cite>unrelaxed.cfg</cite> file exists</dt>
<dd>(during the relaxation step of the worflow, see below,
configurations that can’t be relaxed are saved to the
<cite>unrelaxed.cfg</cite> file) then use it to start the relaxation step from
rather than <cite>to_relax.cfg</cite>. Can take either <cite>True</cite> or <cite>False</cite>,
default <cite>False</cite>.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><strong>use_mpi</strong>: (bool) If TRUE then the <cite>mtp</cite> commands written to the</dt>
<dd>jobfiles that can be executed using <cite>mpi</cite> will be. Can take <cite>True</cite>
or <cite>False</cite>, default value <cite>True</cite>.</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="example-yml-section">
<h3>Example YML section<a class="headerlink" href="#example-yml-section" title="Permalink to this headline">¶</a></h3>
<p>Example of the <cite>fits</cite> portion of the <cite>fitting</cite> section of the yml file
with <cite>mtp</cite>. For full documentation of the <cite>fitting</cite> section see
<a class="reference internal" href="../fitting.html"><span class="doc">Potential Fitting API</span></a>.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">fits</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="s">&quot;AgPd&quot;</span>
    <span class="nt">dbs</span><span class="p">:</span> <span class="p p-Indicator">[</span><span class="s">&quot;*&quot;</span><span class="p p-Indicator">]</span>
    <span class="nt">steps</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">type</span><span class="p">:</span> <span class="s">&quot;mtp.MTP&quot;</span>
        <span class="nt">select</span><span class="p">:</span>
          <span class="nt">selection-limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">200</span>
        <span class="nt">relax</span><span class="p">:</span>
          <span class="nt">iteration_limit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500</span>
        <span class="nt">calc_grade</span><span class="p">:</span>
          <span class="nt">selec-threshopld</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">5.0</span>
        <span class="nt">train</span><span class="p">:</span>
          <span class="nt">max-iter</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">500</span>
        <span class="nt">crystals_to_relax</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">bcc</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">fcc</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">prototypes</span>
        <span class="nt">larges_relax_cell</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">8</span>
        <span class="nt">use_mpi</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">False</span>
        <span class="nt">species</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;Ag&quot;</span>
          <span class="p p-Indicator">-</span> <span class="s">&quot;Pd&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mtp-potential-fitting-workflow">
<h2>MTP Potential Fitting Workflow<a class="headerlink" href="#mtp-potential-fitting-workflow" title="Permalink to this headline">¶</a></h2>
<p>MTP uses an active learning framework to learn the potential landscape
for a material. Since this is obviously an interative process it
requires a slightly different workflow than other fitting
methods. Depending on which step in the process is being used the
number of cores and amound of memory to use specified in the <cite>yml</cite>
file’s <cite>execution</cite> section should be adjusted.</p>
<p>The steps, once the initial database is complete, are as follows:</p>
<div class="section" id="first-iteration">
<h3>First Iteration<a class="headerlink" href="#first-iteration" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up the files needed for an
<cite>mtp</cite> model to be trained.</li>
<li>Run <cite>matdb_train.py cntrl -x</cite> submits the computations to the queue
(can be run on multiple processors).</li>
<li>Run <cite>matdb_trani.py cntrl -t</cite> sets up the files to build a list of
structures to test the potential against.</li>
<li>Run <cite>matdb_train.py cntrl -x</cite> submits the computation to the queue (single core job).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up files to perform a test
relaxation step on the structure list created in steps 3 and 4.</li>
<li>Run <cite>matdb_trani.py cntrl -x</cite> submits the relaxation calculations
to the queue (can be run with multiple processors).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up the files needed to select
new structures for the potential, i.e., the active learning
algorithm selects structures that will improve the potential.</li>
<li>Run <cite>matdb_train.py cntrl -x</cite> to submit the job to the queue
(single core process).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> adss the selected configurations to
the <a class="reference internal" href="../database/active.html"><span class="doc">Active Database Documentation</span></a> for calculation with a first principles
code and submits them to the job queue.</li>
</ol>
</div>
<div class="section" id="second-iteration">
<h3>Second Iteration<a class="headerlink" href="#second-iteration" title="Permalink to this headline">¶</a></h3>
<p>The second iteration can be started once the first principles
calculations are complete.</p>
<ol class="arabic simple">
<li>Run <cite>matdb_build.py cntrl -e</cite> to extract data from the new
configurations in the <a class="reference internal" href="../database/active.html"><span class="doc">Active Database Documentation</span></a>.</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up the files to update the <cite>mtp</cite>
potential.</li>
<li>Run <cite>matdb_train.py cntrl -x</cite> submits the computations to the queue
(can be run on multiple processors).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up files to perform a test
relaxation step on the structure list created in steps 3 and 4 of
the first iteration.</li>
<li>Run <cite>matdb_trani.py cntrl -x</cite> submits the relaxation calculations
to the queue (can be run with multiple processors).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> sets up the files needed to select
new structures for the potential, i.e., the active learning
algorithm selects structures that will improve the potential.</li>
<li>Run <cite>matdb_train.py cntrl -x</cite> to submit the job to the queue
(single core process).</li>
<li>Run <cite>matdb_train.py cntrl -t</cite> adss the selected configurations to
the <a class="reference internal" href="../database/active.html"><span class="doc">Active Database Documentation</span></a> for calculation with a first principles
code and submits them to the job queue.</li>
</ol>
<p>The process for the second iteration is repeated until either the
potential is able to relax all structures in the list of test
configurations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is possible to change the list of configurations that the
potential is trained against at any point, however doing so
will require that the list be re-computed and add those
steps back into the workflow for that iteration.</p>
</div>
</div>
</div>
<div class="section" id="module-matdb.fitting.mtp">
<span id="mtp-modules"></span><h2>MTP Modules<a class="headerlink" href="#module-matdb.fitting.mtp" title="Permalink to this headline">¶</a></h2>
<p>Implements classes and methods for performing a GAP fit over a
database defined in the YAML specification file.</p>
<dl class="class">
<dt id="matdb.fitting.mtp.MTP">
<em class="property">class </em><code class="descclassname">matdb.fitting.mtp.</code><code class="descname">MTP</code><span class="sig-paren">(</span><em>controller=None</em>, <em>dbs=None</em>, <em>execution=None</em>, <em>split=None</em>, <em>root=None</em>, <em>parent=None</em>, <em>dbfilter=None</em>, <em>**mtpargs</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/matdb/fitting/mtp.html#MTP"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#matdb.fitting.mtp.MTP" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements a simple wrapper around the MTP training functionality for
creating MTP potentials.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>controller</strong> (<a class="reference internal" href="controller.html#matdb.fitting.controller.TController" title="matdb.fitting.controller.TController"><em>matdb.fitting.controller.TController</em></a>) – fitting controller
provides access to previous fitting steps and training/validation data.</li>
<li><strong>split</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)"><em>str</em></a>) – name of the split specification to use for training.</li>
<li><strong>execution</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – settings needed to configure the jobfile for running
the GAP fit.</li>
<li><strong>dbs</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.7)"><em>list</em></a>) – list of <cite>str</cite> patterns from the database that should be included
in the training and validation.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="matdb.fitting.mtp.MTP.name">
<code class="descname">name</code><a class="headerlink" href="#matdb.fitting.mtp.MTP.name" title="Permalink to this definition">¶</a></dt>
<dd><p>name of the folder in which all the fitting for this trainer
takes place; defaults to <cite>{n}b</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="matdb.fitting.mtp.MTP.root">
<code class="descname">root</code><a class="headerlink" href="#matdb.fitting.mtp.MTP.root" title="Permalink to this definition">¶</a></dt>
<dd><p>root directory that this trainer operates in.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.7)">str</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="attribute">
<dt id="matdb.fitting.mtp.MTP.params">
<code class="descname">params</code><a class="headerlink" href="#matdb.fitting.mtp.MTP.params" title="Permalink to this definition">¶</a></dt>
<dd><p>key-value pairs that are parameters for the model
fitting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Type:</th><td class="field-body"><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)">dict</a></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="matdb.fitting.mtp.MTP.command">
<code class="descname">command</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/matdb/fitting/mtp.html#MTP.command"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#matdb.fitting.mtp.MTP.command" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the command that is needed to train the GAP
potentials specified by this object.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method also configures the directory that the command
will run in so that it has the relevant files.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="matdb.fitting.mtp.MTP.ready">
<code class="descname">ready</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/matdb/fitting/mtp.html#MTP.ready"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#matdb.fitting.mtp.MTP.ready" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines if the potential is ready for use.</p>
</dd></dl>

<dl class="method">
<dt id="matdb.fitting.mtp.MTP.status">
<code class="descname">status</code><span class="sig-paren">(</span><em>printed=True</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/matdb/fitting/mtp.html#MTP.status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#matdb.fitting.mtp.MTP.status" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns or prints the current status of the MTP training.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>printed</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.7)"><em>bool</em></a>) – when True, print the status to screen; otherwise,
return a dictionary with the relevant quantities.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="matdb.fitting.mtp.create_to_relax">
<code class="descclassname">matdb.fitting.mtp.</code><code class="descname">create_to_relax</code><span class="sig-paren">(</span><em>setup_args</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/matdb/fitting/mtp.html#create_to_relax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#matdb.fitting.mtp.create_to_relax" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the to-relax.cfg file from the passed in args dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>setup_args</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#dict" title="(in Python v3.7)"><em>dict</em></a>) – A dictionary containing the arguments needed to
construct the potential.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Fitting for MTP Potentials</a><ul>
<li><a class="reference internal" href="#yml-file-specifications">YML file specifications</a><ul>
<li><a class="reference internal" href="#relax-ini">relax_ini</a></li>
<li><a class="reference internal" href="#crystals-to-relax">crystals_to_relax</a></li>
<li><a class="reference internal" href="#train">train</a></li>
<li><a class="reference internal" href="#calc-grade">calc_grade</a></li>
<li><a class="reference internal" href="#relax">relax</a></li>
<li><a class="reference internal" href="#select">select</a></li>
<li><a class="reference internal" href="#other">Other</a></li>
<li><a class="reference internal" href="#example-yml-section">Example YML section</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mtp-potential-fitting-workflow">MTP Potential Fitting Workflow</a><ul>
<li><a class="reference internal" href="#first-iteration">First Iteration</a></li>
<li><a class="reference internal" href="#second-iteration">Second Iteration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-matdb.fitting.mtp">MTP Modules</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../fitting.html"
                        title="previous chapter">Potential Fitting API</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="basic.html"
                        title="next chapter">Basic Trainer Documentation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/fitting/mtp.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="basic.html" title="Basic Trainer Documentation"
             >next</a> |</li>
        <li class="right" >
          <a href="../fitting.html" title="Potential Fitting API"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">matdb 0.0.5 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../fitting.html" >Potential Fitting API</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, Conrad W. Rosenbrock.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.5.
    </div>
  </body>
</html>